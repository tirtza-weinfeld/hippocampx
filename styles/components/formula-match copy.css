/* =============================================================================
   FORMULA MATCH — Tailwind 4.1+ Semantic Tokens
   @theme • @utility • oklch • relative color • light-dark()
   ============================================================================= */

/* -----------------------------------------------------------------------------
   ADAPTIVE COLORS — Single source of truth via light-dark()
   ----------------------------------------------------------------------------- */

:root {
  color-scheme: light dark;

  /* Semantic palette - adaptive */
  --color-critical: light-dark(oklch(0.58 0.26 29), oklch(0.73 0.234 29));
  --color-warning: light-dark(oklch(0.70 0.18 75), oklch(0.85 0.162 75));
  --color-success: light-dark(oklch(0.52 0.19 160), oklch(0.67 0.171 160));
  --color-info: light-dark(oklch(0.55 0.17 250), oklch(0.70 0.153 250));
  --color-primary: light-dark(oklch(0.52 0.22 275), oklch(0.67 0.198 275));
  --color-secondary: light-dark(oklch(0.54 0.20 310), oklch(0.69 0.18 310));
  --color-neutral: light-dark(oklch(0.48 0.02 265), oklch(0.63 0.018 265));
  --color-muted: light-dark(oklch(0.92 0.01 265), oklch(0.25 0.01 265));
  --color-accent: light-dark(oklch(0.58 0.24 340), oklch(0.73 0.216 340));

  /* Prominence modifiers for light/dark */
  --soft-bg-l: light-dark(0.97, 0.22);
  --soft-border-l: light-dark(0.88, 0.35);
  --soft-text-offset: light-dark(-0.35, 0.45);
  --soft-inset-alpha: light-dark(0.5, 0.06);
  --outline-bg-l: light-dark(0.98, 0.15);
  --ring-inner-l: light-dark(0.98, 0.15);
}

/* Map :root vars to @theme for utility generation */
@theme inline {
  --color-critical: var(--color-critical);
  --color-warning: var(--color-warning);
  --color-success: var(--color-success);
  --color-info: var(--color-info);
  --color-primary: var(--color-primary);
  --color-secondary: var(--color-secondary);
  --color-neutral: var(--color-neutral);
  --color-muted: var(--color-muted);
  --color-accent: var(--color-accent);
}

/* -----------------------------------------------------------------------------
   THEME — Easing & Animations
   ----------------------------------------------------------------------------- */

@theme {
  --ease-spring: linear(
    0, 0.006, 0.025 2.8%, 0.101 6.1%, 0.539 18.9%, 0.721 25.3%, 0.849 31.5%,
    0.937 38.1%, 0.968 41.8%, 0.991 45.7%, 1.006 50%, 1.015 55%, 1.017 63.9%,
    1.001 85.5%, 1
  );

  --ease-bounce: linear(
    0, 0.004, 0.016, 0.035, 0.063 9.1%, 0.141 13.6%, 0.25, 0.391, 0.563,
    0.765, 1 36.4%, 1.089 40.9%, 1.148 45.5%, 1.167, 1.156, 1.117 59.1%,
    1.067, 1 68.2%, 0.946, 0.908, 0.885, 0.879, 0.896 86.4%, 0.949, 1
  );

  --animate-shake: shake 0.4s var(--ease-bounce);
  --animate-pulse-glow: pulse-glow 2s ease-in-out infinite;
  --animate-fade-in: fade-in 0.3s var(--ease-spring) both;
  --animate-scale-in: scale-in 0.25s var(--ease-spring) both;
  --animate-pop: pop 0.3s var(--ease-bounce);

  @keyframes shake {
    0%, 100% { transform: translateX(0) rotate(0); }
    25% { transform: translateX(-5px) rotate(-0.5deg); }
    75% { transform: translateX(5px) rotate(0.5deg); }
  }

  @keyframes pulse-glow {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  @keyframes fade-in {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes scale-in {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }

  @keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
}

/* -----------------------------------------------------------------------------
   SURFACE — Container composition

   Usage: <div class="surface-soft-success">
          <div class="surface-solid-primary">
   ----------------------------------------------------------------------------- */

/* Surface soft variants */
@utility surface-soft-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.xl);
  background: oklch(from var(--base) var(--soft-bg-l) 0.02 h / 0.95);
  border: 1px solid oklch(from var(--base) var(--soft-border-l) 0.04 h / 0.3);
  box-shadow:
    inset 0 1px 1px oklch(1 0 0 / var(--soft-inset-alpha)),
    0 2px 12px -4px oklch(from var(--base) 0.4 0.08 h / 0.15);
  backdrop-filter: blur(12px);
}

/* Surface solid variants */
@utility surface-solid-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.xl);
  background: linear-gradient(
    155deg,
    oklch(from var(--base) calc(l + 0.06) c h) 0%,
    var(--base) 50%,
    oklch(from var(--base) calc(l - 0.08) c h) 100%
  );
  border: 1px solid oklch(from var(--base) calc(l + 0.12) c h / 0.3);
  box-shadow:
    inset 0 1px 1px oklch(from var(--base) calc(l + 0.25) 0.02 h / 0.4),
    0 2px 8px -2px oklch(from var(--base) calc(l - 0.15) c h / 0.4),
    0 0 20px -6px var(--base);
}

/* Surface outline variants */
@utility surface-outline-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.xl);
  background: oklch(from var(--base) var(--outline-bg-l) 0.01 h / 0.3);
  border: 1.5px solid var(--base);
  box-shadow: 0 0 12px -4px var(--base);
}

/* Surface ghost variants */
@utility surface-ghost-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.xl);
  background: transparent;
  border: 1px solid transparent;
  box-shadow: none;
}

[class*="surface-"]:focus-visible {
  outline: 2px solid var(--base);
  outline-offset: 3px;
}

/* -----------------------------------------------------------------------------
   CONTROL — Interactive element composition

   Usage: <button class="control-soft-neutral">
          <button class="control-solid-success">
   ----------------------------------------------------------------------------- */

/* Control soft variants */
@utility control-soft-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.lg);
  cursor: pointer;
  transition: transform 0.25s ease-spring, box-shadow 0.25s ease-spring, background 0.2s ease-spring;
  background: oklch(from var(--base) var(--soft-bg-l) 0.02 h / 0.95);
  border: 1px solid oklch(from var(--base) var(--soft-border-l) 0.04 h / 0.3);
  color: oklch(from var(--base) calc(l + var(--soft-text-offset)) 0.03 h);
  box-shadow:
    inset 0 1px 1px oklch(1 0 0 / var(--soft-inset-alpha)),
    0 2px 8px -3px oklch(from var(--base) 0.4 0.06 h / 0.2);
  backdrop-filter: blur(12px);
}

/* Control solid variants */
@utility control-solid-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.lg);
  cursor: pointer;
  transition: transform 0.25s ease-spring, box-shadow 0.25s ease-spring, background 0.2s ease-spring;
  background: linear-gradient(
    155deg,
    oklch(from var(--base) calc(l + 0.06) c h) 0%,
    var(--base) 50%,
    oklch(from var(--base) calc(l - 0.08) c h) 100%
  );
  border: 1px solid oklch(from var(--base) calc(l + 0.12) c h / 0.3);
  color: oklch(0.98 0.01 0);
  box-shadow:
    inset 0 1px 1px oklch(from var(--base) calc(l + 0.25) 0.02 h / 0.4),
    0 2px 8px -2px oklch(from var(--base) calc(l - 0.15) c h / 0.4),
    0 0 16px -6px var(--base);
  text-shadow: 0 1px 2px oklch(0 0 0 / 0.25);
}

/* Control outline variants */
@utility control-outline-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.lg);
  cursor: pointer;
  transition: transform 0.25s ease-spring, box-shadow 0.25s ease-spring, background 0.2s ease-spring;
  background: oklch(from var(--base) var(--outline-bg-l) 0.01 h / 0.3);
  border: 1.5px solid var(--base);
  color: var(--base);
  box-shadow: 0 0 12px -4px var(--base);
}

/* Control ghost variants */
@utility control-ghost-* {
  --base: --value(--color-*);
  border-radius: theme(borderRadius.lg);
  cursor: pointer;
  transition: transform 0.25s ease-spring, box-shadow 0.25s ease-spring, background 0.2s ease-spring;
  background: transparent;
  border: 1px solid transparent;
  color: var(--base);
  box-shadow: none;
}

/* -----------------------------------------------------------------------------
   CONTROL INTERACTIONS
   ----------------------------------------------------------------------------- */

[class*="control-"]:hover:not(:disabled) {
  transform: translateY(-2px);
}

[class*="control-solid-"]:hover:not(:disabled) {
  box-shadow:
    inset 0 1px 1px oklch(from var(--base) calc(l + 0.25) 0.02 h / 0.4),
    0 6px 16px -4px oklch(from var(--base) calc(l - 0.15) c h / 0.5),
    0 0 24px -6px var(--base);
}

[class*="control-soft-"]:hover:not(:disabled),
[class*="control-outline-"]:hover:not(:disabled) {
  box-shadow: 0 4px 16px -4px oklch(from var(--base) 0.4 0.08 h / 0.25);
}

[class*="control-"]:active:not(:disabled) {
  transform: translateY(0) scale(0.98);
  transition-duration: 0.1s;
}

[class*="control-"]:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

[class*="control-solid-"]:disabled {
  filter: grayscale(0.2);
}

[class*="control-"]:focus-visible {
  outline: 2px solid oklch(from var(--base) calc(l + 0.2) c h);
  outline-offset: 3px;
}

/* -----------------------------------------------------------------------------
   INK — Text color for surfaces
   ----------------------------------------------------------------------------- */

@utility ink-soft {
  color: oklch(from var(--base, var(--color-neutral)) calc(l + var(--soft-text-offset)) 0.03 h);
}

@utility ink-solid {
  color: oklch(0.98 0.01 0);
  text-shadow: 0 1px 2px oklch(0 0 0 / 0.25);
}

/* -----------------------------------------------------------------------------
   PROGRESS RING — Circular progress indicator
   ----------------------------------------------------------------------------- */

@utility progress-ring {
  --progress: 0;
  width: 3rem;
  height: 3rem;
  border-radius: 50%;
  background: conic-gradient(
    var(--color-success) calc(var(--progress) * 360deg),
    oklch(0.9 0.01 0) calc(var(--progress) * 360deg)
  );
  display: grid;
  place-items: center;
}

.progress-ring::after {
  content: '';
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  background: oklch(var(--ring-inner-l) 0.01 0);
}

/* -----------------------------------------------------------------------------
   STAGGER CHILDREN — Staggered entrance animation
   ----------------------------------------------------------------------------- */

@utility stagger-children {
  & > * {
    animation: fade-in 0.4s var(--ease-spring) both;
  }

  & > *:nth-child(1) { animation-delay: 0ms; }
  & > *:nth-child(2) { animation-delay: 50ms; }
  & > *:nth-child(3) { animation-delay: 100ms; }
  & > *:nth-child(4) { animation-delay: 150ms; }
  & > *:nth-child(5) { animation-delay: 200ms; }
  & > *:nth-child(6) { animation-delay: 250ms; }
  & > *:nth-child(7) { animation-delay: 300ms; }
  & > *:nth-child(8) { animation-delay: 350ms; }
}
