# Example: React 19 Workflow

## Resizable Table of Contents

## Overview

This example shows all four Claude Code mechanisms working together to enforce modern React 19.2+ patterns and prevent legacy code generation.

| Mechanism | Role |
|-----------|------|
| **Skill** | Teaches React 19 patterns |
| **Subagent** | Reviews components for legacy patterns |
| **Hook** | Auto-triggers review after edits |
| **MCP** | Connects to Storybook for component preview |

## The Problem

Claude's training data includes years of legacy React patterns:
- `forwardRef` (deprecated)
- `useCallback`/`useMemo` (compiler handles)
- `useEffect` for data fetching (use `use()`)
- `onChange` + `useState` for forms (use `useActionState`)

## The Solution

### 1. Skill: React 19 Patterns

`.claude/skills/react-19/SKILL.md`:

```markdown
---
name: react-19
description: Modern React 19.2+ patterns and best practices
globs: ["**/*.tsx", "**/*.jsx"]
---

# React 19.2+ Patterns

You are an expert in modern React. Follow these patterns exactly.

## Do Use

- `ref` as a prop (no forwardRef wrapper)
- `use()` for data fetching in components
- `useActionState` for form state and submission
- `useEffectEvent` for stable event callbacks
- `<Activity>` for hide/show without unmount
- `<ViewTransition>` for animations
- Server Components by default

## Don't Use

- forwardRef (deprecated — ref is now a regular prop)
- useCallback/useMemo (React Compiler handles memoization)
- useEffect for data fetching (use `use()` with Suspense)
- onChange + useState for forms (use `useActionState`)
- PropTypes (use TypeScript)
- defaultProps (use default parameters)

## Examples

See `examples/` folder for correct patterns.
```

`.claude/skills/react-19/examples/form-action.tsx`:

```tsx
'use client'

import { useActionState } from 'react'
import { submitForm } from './actions'

export function ContactForm() {
  const [state, formAction, isPending] = useActionState(submitForm, null)

  return (
    <form action={formAction}>
      <input name="email" type="email" required />
      <button disabled={isPending}>
        {isPending ? 'Sending...' : 'Submit'}
      </button>
      {state?.error && <p>{state.error}</p>}
    </form>
  )
}
```

`.claude/skills/react-19/examples/data-fetch.tsx`:

```tsx
import { use, Suspense } from 'react'

async function getData() {
  const res = await fetch('/api/data')
  return res.json()
}

function DataDisplay({ dataPromise }: { dataPromise: Promise<Data> }) {
  const data = use(dataPromise)
  return <div>{data.title}</div>
}

export function Page() {
  return (
    <Suspense fallback={<p>Loading...</p>}>
      <DataDisplay dataPromise={getData()} />
    </Suspense>
  )
}
```

`.claude/skills/react-19/examples/ref-prop.tsx`:

```tsx
// No forwardRef needed — ref is a regular prop
function Input({ ref, ...props }: { ref?: React.Ref<HTMLInputElement> }) {
  return <input ref={ref} {...props} />
}

// Usage
function Form() {
  const inputRef = useRef<HTMLInputElement>(null)
  return <Input ref={inputRef} placeholder="Name" />
}
```

### 2. Subagent: React Reviewer

`.claude/agents/react-reviewer.md`:

```markdown
---
name: react-reviewer
description: Reviews React code for modern patterns. Use PROACTIVELY after writing components.
tools: Read, Grep, Glob
model: haiku
skills: react-19
---

You review React components for React 19.2+ best practices.

## Check For

Legacy patterns that must be replaced:

| Legacy | Modern |
|--------|--------|
| `forwardRef` | `ref` as prop |
| `useCallback` | Remove (compiler) |
| `useMemo` | Remove (compiler) |
| `useEffect` + fetch | `use()` |
| `useState` + `onChange` | `useActionState` |
| `PropTypes` | TypeScript |

## Output Format

For each file reviewed:

1. **Issues Found** (with line numbers)
2. **How to Fix** (specific code change)
3. **Modern Pattern** (correct example)

If no issues: "✓ Component follows React 19.2+ patterns"
```

### 3. Hook: Auto-Review on Edit

`.claude/settings.json`:

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT_FILE_PATH\" | grep -qE '\\.(tsx|jsx)$'; then echo '{\"message\": \"React component modified — consider running react-reviewer\"}'; fi"
          }
        ]
      }
    ]
  }
}
```

For automatic review (bypasses permission prompt):

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "if echo \"$CLAUDE_TOOL_INPUT_FILE_PATH\" | grep -qE '\\.(tsx|jsx)$'; then echo '{\"subagent\": \"react-reviewer\", \"file\": \"'\"$CLAUDE_TOOL_INPUT_FILE_PATH\"'\"}'; fi"
          }
        ]
      }
    ]
  }
}
```

### 4. MCP: Storybook Integration (Optional)

`.mcp.json`:

```json
{
  "mcpServers": {
    "storybook": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@anthropic/mcp-storybook"],
      "env": {
        "STORYBOOK_URL": "http://localhost:6006"
      }
    }
  }
}
```

This enables:
- `mcp__storybook__list_stories` — see available components
- `mcp__storybook__get_story` — view component source/props
- `mcp__storybook__screenshot` — visual preview

## How They Work Together

```text
You: "Create a contact form component"

1. SKILL LOADS
   → Claude sees globs match *.tsx
   → React 19 patterns injected into context

2. CLAUDE WRITES CODE
   → Uses useActionState (not useState + onChange)
   → Uses ref as prop (not forwardRef)

3. HOOK TRIGGERS
   → PostToolUse detects .tsx file edited
   → Suggests running react-reviewer

4. SUBAGENT REVIEWS
   → react-reviewer spawns with react-19 skill
   → Checks for legacy patterns
   → Reports any issues found

5. MCP PREVIEWS (optional)
   → Storybook server shows component
   → Visual verification
```

## File Structure

```text
.claude/
├── skills/
│   └── react-19/
│       ├── SKILL.md
│       └── examples/
│           ├── form-action.tsx
│           ├── data-fetch.tsx
│           └── ref-prop.tsx
├── agents/
│   └── react-reviewer.md
└── settings.json

.mcp.json
```

## Results

With this setup:
- Claude generates modern React 19.2+ code by default
- Legacy patterns are caught immediately
- No manual review needed
- Consistent patterns across team (commit `.claude/` to repo)
