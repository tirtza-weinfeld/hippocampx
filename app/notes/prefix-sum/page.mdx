
# Prefix Sums: Trip Segments & Highway Markers

## Resizable Table of Contents

## The Power of a Pre-Calculated Route

Imagine you're on a long highway road trip. The road has mile markers posted sequentially, starting from Mile 0. If you just passed marker 75 and your exit is at marker 180, you instantly know the distance you have left to travel: `180 - 75 = 105` miles.

These **Highway Markers** are a perfect real-world example of a pre-calculated system. Each marker represents the total distance from the start of the highway. This allows you to find the distance between *any* two points with a single subtraction, without having to measure the road yourself. This is the core idea behind **prefix sums**.

For an array of numbers representing sequential trip segments, its prefix sum array is the set of highway markers. The value at `Markers[i]` is the sum of all trip segments from the start (`Segments[0]`) through the current one (`Segments[i]`).

  * **Original Trip Segments (`segments`):** `[120, -30, 200, -50, 150]`
    *(This is the actual distance traveled each day: 120km east, 30km west, 200km east, etc.)*
  * **Highway Markers (`Markers` - the Prefix Sum):** `[120, 90, 290, 240, 390]`
    *(This is the mile marker you're at after each day's travel.)*

The magic trick is that the total distance of any continuous "segment" of your trip, from day `i` to day `j`, is simply `Markers[j] - Markers[i-1]`. This allows us to answer any range query in constant $O(1)$ time after one $O(n)$ pass to build the `Markers` array.

By combining this technique with a hash map to remember past marker locations, we can solve a huge range of otherwise complex problems with surprising efficiency. Let's see it in action.

-----

## 1\. Longest Streak Covering Exassctly k Kilometers

**[LeetCode 325: Maximum Size Subarray Sum Equals k](https://leetcode.com/problems/maximum-size-subarray-sum-equals-k/)**

*You need a sightseeing record: find the longest continuous sequence of trip segments whose combined length is exactly **k km**.*

```python file=examples/code/prefix_sum.py#func:maxSubArrayLen stripDocstring
```

-----

## 2\. Count of Streaks Covering k Kilometers

**[LeetCode 560: Subarray Sum Equals K](https://leetcode.com/problems/subarray-sum-equals-k/)**

*How many distinct, continuous sequences of trip segments have a total length of exactly **k km**?*

```python file=examples/code/prefix_sum.py#func:subarraySum stripDocstring
```

-----

## 3\. Longest Balanced Forward/Backward Day-Count

**[LeetCode 525: Contiguous Array](https://leetcode.com/problems/contiguous-array/)**

*To balance your trip, find the longest continuous sequence of segments with an equal number of forward (+1 km) and backward (-1 km) movements. This is equivalent to finding the longest sequence of segments whose total length is 0.*

```python file=examples/code/prefix_sum.py#func:findMaxLength stripDocstring
```

-----

## 4\. Detecting a Segment of k-Multiple Distance

**[LeetCode 523: Continuous Subarray Sum](https://leetcode.com/problems/continuous-subarray-sum/)**

*Did any continuous part of your trip, lasting at least two days, cover a total distance that was an exact **multiple of k km**?*

```python file=examples/code/prefix_sum.py#func:checkSubarraySum stripDocstring
```

-----

## 5\. Counting All Spans Divisible by k

**[LeetCode 974: Subarray Sums Divisible by K](https://leetcode.com/problems/subarray-sums-divisible-by-k/)**

*How many continuous sequences of trip segments have a total length that is perfectly divisible by k?*

```python file=examples/code/prefix_sum.py#func:subarraysDivByK stripDocstring
```

-----

## 6\. Minimal Segment to Skip

**[LeetCode 1590: Make Sum Divisible by P](https://leetcode.com/problems/make-sum-divisible-by-p/)**

*Your total trip length (the final highway marker) isnâ€™t divisible by `p`. Find the **shortest continuous trip segment** you can remove from your log, so that the length of the remaining segments *is* divisible by `p`.*

```python file=examples/code/prefix_sum.py#func:minSubarray stripDocstring
```

-----

## 7\. Batch Itinerary Updates (Difference Array)

**[LeetCode 370: Range Addition](https://leetcode.com/problems/range-addition/)**

*You are a trip planner. You start with an itinerary for `length` days, with 0 km planned for each day. You are given a list of `updates`, like `[start_day, end_day, change_in_km]`. You must add `change_in_km` to the plan for each day in that range. What is the final daily travel plan? This is the inverse of our previous problems; we use a "difference array" and find its prefix sum to reveal the final state.*

```python file=examples/code/prefix_sum.py#func:getModifiedArray stripDocstring
```

  * **Time Complexity:** $O(\\text{length} + k)$, where $k$ = `len(updates)`
  * **Space Complexity:** $O(\\text{length})$

-----

## 8\. Finding a Valid Starting Point on the Highway

**[LeetCode 2145: Count the Hidden Sequences](https://leetcode.com/problems/count-the-hidden-sequences/)**

*You have a log of your daily trsip segments (`differences`) but forgot your starting point on the highway. You only know that your location at all times (your starting point and every marker you passed) had to be within a valid range of the highway, `[lower, upper]`. How many possible integer **starting markers** could you have begun your trip from?*

```python file=examples/code/prefix_sum.py#func:numberOfArrays stripDocstring
```

  * **Time Complexity:** $O(n)$
  * **Space Complexity:** $O(1)$

