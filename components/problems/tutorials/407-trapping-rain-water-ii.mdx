# Trapping Rain Water II

## Resizable Table Of contents

<DifficultyBadge difficulty="hard" />

<PillList pills={["dijkstra", "heap"]} />

[407. Trapping Rain Water II](https://leetcode.com/problems/trapping-rain-water-ii/)

## [!(ProblemDefinition)] Definition

Given an m x n integer matrix heightMap representing the height of each unit cell in a 2D elevation map, return the volume of water it can trap after raining

## [!(ProblemCodeSnippet)] Code Snippet

```python meta="source=problems/407-trapping-rain-water-ii/solution.py"
from heapq import heapify, heappush, heappop

def trapRainWater(heightMap: list[list[int]]) -> int:

    R, C = len(heightMap), len(heightMap[0])
    is_border = lambda r, c: r in (0, R - 1) or c in (0, C - 1)
    heapify(heap := [(heightMap[r][c], r, c)for r in range(R)for c in range(C)if is_border(r, c)])
    vis = [[is_border(r, c) for c in range(C)] for r in range(R)]

    water = 0
    while heap:
        h, r, c = heappop(heap)
        for nr, nc in ((r + 1, c), (r - 1, c), (r, c + 1), (r, c - 1)):
            if 0 <= nr < R and 0 <= nc < C and not vis[nr][nc]:
                vis[nr][nc] = True
                if (nh := heightMap[nr][nc]) < h:
                    water += h - nh
                heappush(heap, (h if h > nh else nh, nr, nc))
    return water
```

