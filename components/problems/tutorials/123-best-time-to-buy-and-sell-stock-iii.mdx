# Best Time to Buy and Sell Stock III

## Resizable Table Of contents

<DifficultyBadge difficulty="hard" />

<PillList pills={["dynamic_programming", "array"]} />

[123. Best Time to Buy and Sell Stock III](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii)

## [!ProblemDefinition] Definition

Given a list of daily stock prices `prices`; at most **two** transactions are allowed (cannot overlap). Return the maximum total profit.

## Dp Solution

### [!ProblemIntuition] Intuition

- Cost profit tracking:
    - Track the cost and profit for two separate trades, using the profit from the first trade to reduce the cost of the second trade.

### [!ProblemTimeComplexity] Time Complexity

- O(n):
    - where n is the length of the prices array. We iterate through the array once.

### [!ProblemKeyVariables] Key Variables

- `t1_cost`: cost of first trade
- `t1_profit`: profit of first trade
- `t2_cost`: cost of second trade
- `t2_profit`: profit of second trade

### [!ProblemKeyExpressions] Key Expressions

- `p - t1_profit`: money you'd need now if earlier profit covered part of this buy

### [!ProblemReturns] Returns

`int`: Maximum profit from at most two transactions

### [!ProblemCodeSnippet] Code Snippet

```python meta="source=problems/123-best-time-to-buy-and-sell-stock-iii/dp.py"
def best_time_to_buy_and_sell_stock_III(prices: list[int]) -> int:

    t1_cost = t2_cost = float("inf")
    t1_profit = t2_profit = 0

    for p in prices:

        # First trade
        t1_cost = min(t1_cost, p) 
        t1_profit = max(t1_profit, p - t1_cost)

        # Second trade
        t2_cost = min(t2_cost, p - t1_profit)
        t2_profit = max(t2_profit, p - t2_cost)

    return t2_profit
```


---

## State Solution

### [!ProblemIntuition] Intuition

- hold sell states

### [!ProblemKeyExpressions] Key Expressions

- `hold1 = hold2 = float("-inf")`: money you'd have if holding first stock
- `sell1 = sell2 = 0`: money you'd have if not holding first stock
- `hold1 = max(hold1, -p)`: buy first stock
- `sell1 = max(sell1, hold1 + p)`: sell first stock
- `hold2 = max(hold2, sell1 - p)`: buy second stock
- `sell2 = max(sell2, hold2 + p)`: sell second stock

### [!ProblemCodeSnippet] Code Snippet

```python meta="source=problems/123-best-time-to-buy-and-sell-stock-iii/state.py"
def best_time_to_buy_and_sell_stock_III(prices: list[int]) -> int:
    hold1 = hold2 = float("-inf")
    sell1 = sell2 = 0

    for p in prices:
        hold1 = max(hold1, -p)
        sell1 = max(sell1, hold1 + p)
        hold2 = max(hold2, sell1 - p)
        sell2 = max(sell2, hold2 + p)
    return sell2
```

