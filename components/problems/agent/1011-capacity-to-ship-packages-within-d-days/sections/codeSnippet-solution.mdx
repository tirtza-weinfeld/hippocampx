```python meta="source=problems/1011-capacity-to-ship-packages-within-d-days/solution.py"
def capacity_to_ship_packages_within_d_days(weights: list[int], days: int) -> int:
    def days_needed(capacity: int) -> int:
        d, load = 1, 0
        for w in weights:
            if load + w <= capacity:
                load += w
            else:
                d += 1
                load = w
        return d
    

    l, r = max(weights), sum(weights)
    while l < r:
        capacity = (l + r) // 2
        if days_needed(capacity) <= days:
            r = capacity
        else:
            l = capacity + 1
    return l
```