```python meta="source=problems/312-burst-balloons/solution.py"
class Solution:
    def maxCoins(self, nums: list[int]) -> int:
        
        nums = [1, *nums, 1] 
        memo = {}  

        def dp(i, j):
            if (key:=(i, j)) not in memo:
                memo[key] = max(
                    (
                        dp(i, k) 
                        + nums[i] * nums[k] * nums[j]  
                        + dp(k, j) 
                        for k in range(i + 1, j)     
                    ),
                    default=0  
                )
            return memo[key]

        return dp(0, len(nums) - 1)
```