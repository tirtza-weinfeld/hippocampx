```python meta="source=problems/238-product-of-array-except-self/solution.py"
def product_of_array_except_self(nums: list[int]) -> list[int]:

    pre, res = 1, [1] * (n := len(nums))
    for i, x in enumerate(nums):
        res[i], pre = pre, pre * x
    suf = 1
    for i in range(n - 1, -1, -1):
        res[i], suf = res[i] * suf, suf * nums[i]
    return res
```