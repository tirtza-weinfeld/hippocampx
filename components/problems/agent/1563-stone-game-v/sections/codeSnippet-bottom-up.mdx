```python meta="source=problems/1563-stone-game-v/bottom-up.py"
def stone_game_v(a: list[int]) -> int:
    n = len(a)
    dp = [[0] * n for _ in range(n)]
    mx = [[0] * n for _ in range(n)]
    for i, v in enumerate(a):
        mx[i][i] = v

    for j in range(1, n):
        mid = j
        left = a[j]
        right = 0
        for i in range(j - 1, -1, -1):
            left += a[i]

            while (right + a[mid]) * 2 <= left:
                right += a[mid]
                mid -= 1

            best = 0
            if right * 2 == left:
                best = mx[i][mid]
            if mid != i:
                best = max(best, mx[i][mid - 1])
            if mid != j:
                best = max(best, mx[j][mid + 1])

            dp[i][j] = best
            mx[i][j] = max(mx[i][j - 1], best + left)
            mx[j][i] = max(mx[j][i + 1], best + left)

    return dp[0][n - 1]
```